<template>
    <transition name="showHeader">
        <div v-if="visible" class="header-animat">
            <a-layout-header
                v-if="visible"
                :class="[
                    fixedHeader && 'ant-header-fixedHeader',
                    sidebarOpened
                        ? 'ant-header-side-opened'
                        : 'ant-header-side-closed',
                    theme
                ]"
                :style="{ padding: '0' }"
            >
                <div v-if="mode === 'sidemenu'" class="header">
                    <a-icon
                        v-if="cDevice === 'mobile'"
                        @click="toggle"
                        :type="collapsed ? 'menu-fold' : 'menu-unfold'"
                        class="trigger"
                    />
                    <a-icon
                        v-else
                        @click="toggle"
                        :type="collapsed ? 'menu-unfold' : 'menu-fold'"
                        class="trigger"
                    />
                    <user-menu></user-menu>
                </div>
                <div v-else :class="['top-nav-header-index', theme]">
                    <div class="header-index-wide">
                        <div class="header-index-left">
                            <logo class="top-nav-header" />
                            <client-only>
                                <a-icon
                                    v-if="cDevice === 'mobile'"
                                    @click="toggle"
                                    :type="
                                        collapsed ? 'menu-fold' : 'menu-unfold'
                                    "
                                    class="trigger"
                                />
                                <app-menu
                                    v-else
                                    :theme="theme"
                                    mode="horizontal"
                                />
                            </client-only>
                        </div>
                        <user-menu class="header-index-right"></user-menu>
                    </div>
                </div>
            </a-layout-header>
        </div>
    </transition>
</template>

<script>
    import UserMenu from './Tools/UserMenu';
    import Logo from './Tools/Logo';
    import AppMenu from './Menu/AppMenu';

    export default {
        name: 'GlobalHeader',
        components: {
            AppMenu,
            UserMenu,
            Logo
        },
        props: {
            mode: {
                type: String,
                default: 'sidemenu'
            },
            menus: {
                type: Array,
                required: true
            },
            theme: {
                type: String,
                required: false,
                default: 'dark'
            },
            collapsed: {
                type: Boolean,
                required: false,
                default: false
            },
            cDevice: {
                type: String,
                required: false,
                default: 'desktop'
            }
        },
        data() {
            return {
                visible: true,
                oldScrollTop: 0
            };
        },
        mounted() {
            $(document).ready(() => {
                $(window).scroll(() => {
                    this.handleScroll();
                });
            });
        },
        methods: {
            handleScroll() {
                if (!this.autoHideHeader) {
                    return;
                }

                const scrollTop =
                    document.body.scrollTop +
                    document.documentElement.scrollTop;
                if (!this.ticking) {
                    this.ticking = true;
                    requestAnimationFrame(() => {
                        if (this.oldScrollTop > scrollTop) {
                            this.visible = true;
                        } else if (scrollTop > 300 && this.visible) {
                            this.visible = false;
                        } else if (scrollTop < 300 && !this.visible) {
                            this.visible = true;
                        }
                        this.oldScrollTop = scrollTop;
                        this.ticking = false;
                    });
                }
            },
            toggle() {
                this.$emit('toggle');
            }
        }
    };
</script>

<style lang="scss">
    .header-animat {
        position: relative;
        z-index: 2;
    }

    .showHeader-enter-active {
        transition: all 0.25s ease;
    }

    .showHeader-leave-active {
        transition: all 0.5s ease;
    }

    .showHeader-enter,
    .showHeader-leave-to {
        opacity: 0;
    }
</style>
